<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PDF预览 - 教学成果奖申报网站</title>
    <style>
        /* 复用首页全局变量 */
        :root {
            --primary-color: #B71C1C; /* 深庄重红主色 */
            --secondary-color: #880E4F; /* 深玫红辅助色 */
            --text-dark: #121212; /* 正文深色 */
            --text-light: #333333; /* 正文浅色 */
            --text-gray: #666666; /* 辅助文字色 */
            --bg-main: linear-gradient(135deg, #8B0000 0%, #B71C1C 100%); /* 深红色渐变背景 */
            --bg-card: #ffffff; /* 卡片背景色 */
            --border-color: #E0E0E0; /* 边框色 */
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.2); /* 深色阴影 */
        }
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: "Microsoft YaHei", "Noto Sans SC", Arial, sans-serif; 
        }
        body { 
            background: var(--bg-main);
            color: var(--text-dark);
            height: 100vh; 
            width: 100vw;
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            margin: 0;
            padding: 0;
        }

        /* 复用首页导航栏样式（仅保留返回按钮） */
        .nav-bar {
            background-color: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 0 40px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            height: 60px;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 99;
        }
        .btn-return {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn-return:hover {
            background-color: #9F0000;
        }

        /* PDF容器：单滚动条 + 匹配首页风格 */
        .pdf-container {
            flex: 1;
            width: 100vw;
            height: calc(100vh - 60px);
            overflow: hidden; 
            background-color: var(--bg-card);
            padding: 30px 40px;
            margin: 0;
            position: relative;
        }
        /* PDF预览区域：单滚动条 + 适配首页卡片风格 */
        #pdf-iframe {
            width: 100%;
            max-width: 1400px;
            height: 100%;
            display: block;
            border: none;
            background-color: #FAFAFA;
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow: auto; 
            margin: 0 auto;
        }

        /* 加载提示：匹配首页风格 */
        .loading-overlay {
            position: absolute;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-card);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 97;
        }
        .loading-text {
            font-size: 16px;
            color: var(--text-gray);
            padding: 20px;
            background-color: #FAFAFA;
            border-radius: 6px;
            box-shadow: var(--shadow);
        }

        /* 响应式适配（与首页一致） */
        @media (max-width: 768px) {
            .nav-bar {
                padding: 0 20px;
                height: 50px;
            }
            .btn-return {
                padding: 6px 12px;
                font-size: 13px;
            }
            .pdf-container {
                padding: 15px 20px;
                height: calc(100vh - 50px);
            }
            #pdf-iframe {
                max-width: 100%;
            }
        }
    </style>
</head>
<body oncontextmenu="return false;">
    <!-- 导航栏：仅保留返回按钮 -->
    <div class="nav-bar">
        <button class="btn-return" onclick="goBack()">返回</button>
    </div>

    <!-- PDF预览容器 -->
    <div class="pdf-container">
        <!-- 加载提示 -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-text" id="loadingText">加载PDF中...</div>
        </div>

        <!-- PDF预览区域 -->
        <iframe id="pdf-iframe" onload="hideLoading()" oncontextmenu="return false;"></iframe>
    </div>

    <script>
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const files = params.get('files') || '';
            const firstFile = files.split('|')[0] || '';
            const title = params.get('title') || 'PDF预览';
            const BASE_URL = 'https://xiaogao116.github.io/jiao20251219/';
            return {
                pdfUrl: firstFile ? `${BASE_URL}${encodeURIComponent(firstFile)}` : '',
                title: title
            };
        }

        function goBack() {
            window.history.length > 1 ? window.history.back() : window.location.href = 'index.html';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // 初始化加载PDF
        const { pdfUrl, title } = getUrlParams();
        const iframe = document.getElementById('pdf-iframe');
        if (pdfUrl) {
            // 隐藏PDF默认工具栏 + 适配宽度
            const pdfUrlWithParam = pdfUrl + (pdfUrl.includes('#') ? '&' : '#') + 'toolbar=0&view=FitW';
            iframe.src = pdfUrlWithParam;
            document.title = `${title} - 教学成果奖申报网站`;
            document.getElementById('loadingText').textContent = `加载${title}中...`;
            
            // 超时重试
            setTimeout(() => {
                if (document.getElementById('loadingOverlay').style.display !== 'none') {
                    document.getElementById('loadingText').innerHTML = `
                        加载超时<br>
                        <button onclick="reloadPdf()" style="margin-top:10px; padding:6px 12px; background:var(--primary-color); color:white; border:none; border-radius:4px; font-size:13px;">点击重试</button>
                    `;
                }
            }, 15000);
        } else {
            hideLoading();
            iframe.srcdoc = `<div style="text-align:center; padding:50px; color:var(--text-gray); font-size:16px;">
                未找到PDF文件
            </div>`;
        }

        // 重试加载
        function reloadPdf() {
            document.getElementById('loadingText').textContent = `重新加载${title}中...`;
            const pdfUrlWithParam = pdfUrl + (pdfUrl.includes('#') ? '&' : '#') + `toolbar=0&view=FitW&t=${new Date().getTime()}`;
            iframe.src = pdfUrlWithParam;
        }

        // 禁用打印/下载快捷键
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey && e.key === 's') || (e.ctrlKey && e.key === 'p') || (e.ctrlKey && e.shiftKey && e.key === 'i')) {
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>